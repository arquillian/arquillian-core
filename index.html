<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Arquillian - So you can rule your code. Not the bugs.</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Arquillian - So you can rule your code. Not the bugs.</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_what_is_it">1. What is it?</a>
<ul class="sectlevel2">
<li><a href="#_arquillian_makes_integration_testing_a_breeze">1.1. Arquillian makes integration testing a breeze!</a></li>
</ul>
</li>
<li><a href="#_documentation">2. Documentation</a>
<ul class="sectlevel2">
<li><a href="#_introduction">2.1. Introduction</a></li>
<li><a href="#getting-started">2.2. Getting Started</a></li>
<li><a href="#deployment-archives">2.3. Deployment Archives</a></li>
<li><a href="#_containers">2.4. Containers</a></li>
<li><a href="#_test_enrichers">2.5. Test Enrichers</a></li>
<li><a href="#_additional_features">2.6. Additional Features</a></li>
<li><a href="#_protocols">2.7. Protocols</a></li>
<li><a href="#_build_integration">2.8. Build Integration</a></li>
</ul>
</li>
<li><a href="#_contents_of_distribution">3. Contents of distribution</a></li>
<li><a href="#_licensing">4. Licensing</a></li>
<li><a href="#_arquillian_urls">5. Arquillian URLs</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Arquillian is an innovative and highly extensible testing platform for the JVM that enables developers to
easily create automated integration, functional and acceptance tests for Java middleware.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_it"><a class="anchor" href="#_what_is_it"></a>1. What is it?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Picking up where unit tests leave off, Arquillian handles all the plumbing of container management, deployment and framework initialization so you can focus on the task at hand, writing your tests. Real tests. In short…</p>
</div>
<div class="sect2">
<h3 id="_arquillian_makes_integration_testing_a_breeze"><a class="anchor" href="#_arquillian_makes_integration_testing_a_breeze"></a>1.1. Arquillian makes integration testing a breeze!</h3>
<div class="paragraph">
<p>Arquillian brings the test to the runtime so you don’t have to manage the runtime from the test (or the build). Arquillian eliminates this burden by covering all aspects of test execution, which entails:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Managing the lifecycle of the container (or containers)</p>
</li>
<li>
<p>Bundling the test case, dependent classes and resources into a ShrinkWrap archive (or archives)</p>
</li>
<li>
<p>Deploying the archive (or archives) to the container (or containers)</p>
</li>
<li>
<p>Enriching the test case by providing dependency injection and other declarative services</p>
</li>
<li>
<p>Executing the tests inside (or against) the container</p>
</li>
<li>
<p>Capturing the results and returning them to the test runner for reporting</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To avoid introducing unnecessary complexity into the developer’s build environment, Arquillian integrates seamlessly with familiar testing frameworks (e.g., JUnit 4, TestNG 5), allowing tests to be launched using existing IDE, Ant and Maven test plugins — without any add-ons.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_documentation"><a class="anchor" href="#_documentation"></a>2. Documentation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction"><a class="anchor" href="#_introduction"></a>2.1. Introduction</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#core-principles">Core Principles</a></p>
</li>
<li>
<p><a href="#how-it-works">How It Works</a></p>
</li>
<li>
<p><a href="#integration-testing-in java-ee">Integration Testing In Java EE</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We believe that integration and functional testing should be no more
complex or daunting than unit testing. We created Arquillian to make
that vision a reality.</p>
</div>
<div class="paragraph">
<p><strong>Arquillian is a revolutionary testing platform for Java and the JVM
that enables developers to easily write and execute integration and
functional tests for Java middleware, ranging from Java EE and beyond.</strong></p>
</div>
<div class="paragraph">
<p>Arquillian picks up where unit tests leave off, focusing on the
integration of application code inside a real runtime environment. Much
the same way Java EE 5 simplified the server programming model by
providing declarative services for POJOs, Arquillian equips tests with
container lifecycle management and test case enrichment. Using
Arquillian, you can focus on the test, not the plumbing.</p>
</div>
<div class="paragraph">
<p>In short, Arquillian aims to make integration and functional testing a
breeze.</p>
</div>
<div class="sect3">
<h4 id="core-principles"><a class="anchor" href="#core-principles"></a>2.1.1. Core Principles</h4>
<div class="paragraph">
<p>The Arquillian project adheres to three core principles:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Tests should be portable to any supported container</strong><br>
By keeping container-specific APIs out of the tests, developers can
verify application portability by running tests against a variety of
containers. It also means that lightweight containers can be used as a
substitute for full containers during development.</p>
</li>
<li>
<p><strong>Tests should be executable from both the IDE and the build tool</strong><br>
By leveraging the IDE, the developer can skip the build for a faster
turnaround and has a familiar environment for debugging. These benefits
shouldn&#8217;t sacrifice the ability to run the tests in continuous
integration using a build tool.</p>
</li>
<li>
<p><strong>The platform should extend or integrate existing test frameworks</strong><br>
An extensible architecture encourages reuse of existing software and
fosters a unified Java testing ecosystem.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Arquillian brings your test to the runtime so you don&#8217;t have to manage
the runtime from the test. Arquillian packs the necessary orchestration
logic neatly into the platform an its extensions. As a result, executing
an Arquillian test is as simple as selecting "Run As &gt; Test" in the IDE
or executing the "test" goal from the build tool.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-it-works"><a class="anchor" href="#how-it-works"></a>2.1.2. How It Works</h4>
<div class="paragraph">
<p>Using Arquillian, you write a basic test case and annotate it with
declarative behavior that says, "`@RunWith` Arquillian". This
declaration tells Arquillian to take over execution of the test when
it&#8217;s launched.</p>
</div>
<div class="paragraph">
<p><em>That&#8217;s when the real magic happens</em>.</p>
</div>
<div class="paragraph">
<p>Launching an Arquillian test is as simple as right-clicking the test
class in the IDE and selecting <em>Run As &gt; Test (e.g., JUnit, TestNG,
Spock, etc)</em>. Based on the classpath configuration, Arquillian starts or
binds to the target container (JBoss AS, GlassFish, OpenEJB, etc) and
deploys the test archive defined in the <code>@Deployment</code> method. The
archive includes the test case along with the specified classes,
resources and libraries. Your test then executes inside the container
and enjoys all the same services as an application component. That means
you get dependency and resource injection into the test, you can access
EJBs, you can load a persistence unit, you can get a handle to a
database connection, etc. Arquillian then captures the test results and
transports them back to the test runner for reporting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Arquillian also has a client run mode, which only deploys the test archive, not the test case.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Aside from a few extra declarations (i.e., <code>@RunWith</code> and
<code>@Deployment</code>), an Arquillian test looks like any other unit test and
launched like any other unit test.</p>
</div>
</div>
<div class="sect3">
<h4 id="integration-testing-in-java-ee"><a class="anchor" href="#integration-testing-in-java-ee"></a>2.1.3. Integration Testing In Java EE</h4>
<div class="paragraph">
<p>Integration testing is very important in Java EE. The reason is
two-fold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Business components often interact with resources or sub-system
provided by the container</p>
</li>
<li>
<p>Many declarative services get applied to the business component at
runtime</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first reason is inherent in enterprise applications. For the
application to perform any sort of meaningful work, it has to pull the
strings on other components, resources (e.g., a database) or systems
(e.g., a web service). Having to write any sort of test that requires an
enterprise resource (database connection, entity manager, transaction,
injection, etc) is a non-starter because the developer has no idea what
to even use. Clearly there is a need for a simple solution, and
Arquillian fills that void.</p>
</div>
<div class="paragraph">
<p>Some might argue that, as of Java EE 5, the business logic performed by
most Java EE components can now be tested outside of the container
because they are POJOs. But let&#8217;s not forget that in order to isolate
the business logic in Java EE components from infrastructure services
(transactions, security, etc), many of those services were pushed into
declarative programming constructs. At some point you want to make sure
that the infrastructure services are applied correctly and that the
business logic functions properly within that context, justifying the
second reason that integration testing is important in Java EE.</p>
</div>
<div class="sect4">
<h5 id="testing-the-real-component"><a class="anchor" href="#testing-the-real-component"></a>Testing The Real Component</h5>
<div class="paragraph">
<p>&#8230;&#8203;or, <strong>what you test is what you run.</strong></p>
</div>
<div class="paragraph">
<p>The reality is that you aren&#8217;t really testing your component until you
test it in situ. It&#8217;s all to easy to create a test that puts on a good
show but doesn&#8217;t provide any real guarantee that the code under test
functions properly in a production environment. The show typically
involves mock components and/or bootstrapped environments that cater to
the test. Such "unit tests" can&#8217;t verify that the declarative services
kick in as they should. While unit tests certainly have value in quickly
testing algorithms and business calculations within methods, there still
need to be tests that exercise the component as a complete service.</p>
</div>
<div class="paragraph">
<p>Rather than instantiating component classes in the test using Java&#8217;s new
operator, which is customary in a unit test, Arquillian allows you to
inject the container-managed instance of the component directly into
your test class (or you can look it up in JNDI) so that you are testing
the actual component, just as it runs inside the application.</p>
</div>
</div>
<div class="sect4">
<h5 id="finding-a-happy-medium"><a class="anchor" href="#finding-a-happy-medium"></a>Finding A Happy Medium</h5>
<div class="paragraph">
<p><em>Do you really need to run the test in a real container when a Java SE
CDI environment would do?</em></p>
</div>
<div class="paragraph">
<p>It&#8217;s true, some tests can work without a full container. For instance,
you can run certain tests in a Java SE CDI environment with Arquillian.
Let&#8217;s call these "standalone" tests, whereas tests which do require a
full container are called "integration" tests. Every standalone test can
also be run as an integration test, but not the other way around. While
the standalone tests don&#8217;t need a full container, it&#8217;s also important to
run them as integration tests as a final check just to make sure that
there is nothing they conflict with (or have side effects) when run in a
real container.</p>
</div>
<div class="paragraph">
<p>It might be a good strategy to make as many tests work in standalone
mode as possible to ensure a quick test run, but ultimately you should
consider running all of your tests in the target container. As a result,
you&#8217;ll likely enjoy a more robust code base.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve established that integration testing is important, but how can
integration testing being accomplished without involving every class in
the application? That&#8217;s the benefit that ShrinkWrap brings to
Arquillian.</p>
</div>
</div>
<div class="sect4">
<h5 id="controlling-the-test-classpath"><a class="anchor" href="#controlling-the-test-classpath"></a>Controlling The Test Classpath</h5>
<div class="paragraph">
<p>One huge advantage ShrinkWrap brings to Arquillian is classpath control.
The classpath of a test run has traditionally been a kitchen sink of all
production classes and resources with the test classes and resources
layered on top. This can make the test run indeterministic, or it can
just be hard to isolate test resources from the main resources.</p>
</div>
<div class="paragraph">
<p>Arquillian uses ShrinkWrap to create "micro deployments" for each test,
giving you fine-grained control over what you are testing and what
resources are available at the time the test is executed. An archive can
include classes, resources and libraries. This not only frees you from
the classpath hell that typically haunts test runners (Eclipse, Maven),
it also gives you the option to focus on the interaction between an
subset of production classes, or to easily swap in alternative classes.
Within that grouping you get the self-assembly of services provided by
Java EE---the very integration which is being tested.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s move on and consider some typical usage scenarios for Arquillian.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="getting-started"><a class="anchor" href="#getting-started"></a>2.2. Getting Started</h3>
<div class="paragraph">
<p>We promised that integration and functional testing with Arquillian is
no more complex than writing a unit test. Now it&#8217;s time to prove it to
you. We&#8217;ve prepared a series of guides designed exclusively to teach you
how to use Arquillian. You&#8217;ll have the tests running from both Maven and
Eclipse by the end of the first guide.</p>
</div>
<div class="paragraph">
<p>Head over to the <a href="http://arquillian.org/guides/getting_started">Getting
Started Guide</a> and start writing real tests!</p>
</div>
</div>
<div class="sect2">
<h3 id="deployment-archives"><a class="anchor" href="#deployment-archives"></a>2.3. Deployment Archives</h3>
<div class="paragraph">
<p>Each Arquillian test is associated with at least one deployment. The
deployment is configured using a static method annotated with
<code>@Deployment</code> that returns a ShrinkWrap archive. Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Deployment</span>
<span class="directive">public</span> <span class="directive">static</span> JavaArchive createDeployment() {
    <span class="keyword">return</span> ShrinkWrap.create(JavaArchive.class)
        .addClass(Greeter.class)
        .addAsManifestResource(EmptyAsset.INSTANCE, <span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Why is a deployment necessary?</em></p>
</div>
<div class="paragraph">
<p>If we want to be able to test inside the container, we need some way to
get the code into the container. A container typically accepts some form
of deployment. In most Java-based containers, these deployments are some
sort of Java archive (jar).</p>
</div>
<div class="paragraph">
<p>ShrinkWrap provides a way to define a deployment archive (e.g., jar,
war, ear) in Java using a fluent API. You use this API to create an
deployment that&#8217;s associated with the test case, which we call a "micro
deployment". Arquillian can then use this object to stream the contents
to the server in the most efficient way available.</p>
</div>
<div class="paragraph">
<p>The deployment archive is more than just a means to an end (getting code
inside the container). There are several critical benefits to defining a
deployment:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It allows you to isolate the classpath of the test – only those
classes and resources inside the deployment are visible to the test.</p>
</li>
<li>
<p>You can emulate or replicate a deployment scenario, which often
triggers behavior (e.g., framework activation) that you cannot otherwise
test.</p>
</li>
<li>
<p>We can skip the build. Since the archive is assembled in Java, we&#8217;re
able to leverage the incremental compilation provided by IDEs.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In summary, the strategy of using ShrinkWrap-based deployments gives you
tremendous control over the code you&#8217;re testing and quicker turnaround.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Arquillian provides the SPI
<code>org.jboss.arquillian.spi.client.deployment.DeploymentScenarioGenerator</code>
to allow an alternate means of defining a deployment, including
foregoing the use of a deployment altogether.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_containers"><a class="anchor" href="#_containers"></a>2.4. Containers</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#container-selection">Container Selection</a></p>
</li>
<li>
<p><a href="#container-configuration">Container Configuration</a></p>
</li>
<li>
<p><a href="#supported-containers">Supported Containers</a></p>
</li>
<li>
<p><a href="#container-config-runtime-selection">Container Config Runtime Selection</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Arquillian&#8217;s forte is not only its ease of use, but also its
extensibility. Good integration testing is not just about testing in
<em>any</em> environment, but rather testing in the environment of your
application targets. It&#8217;s easy to give ourselves false assurance by
validating components in a specialized testing container, or by using
mocks, only to realize that small variations and assumptions cause the
components to fail when the application is deployed to production. To make
tests count, you want to execute them in the target environment, or
container.</p>
</div>
<div class="paragraph">
<p><em>So what is the container that Arquillian uses? Is it some proprietary testing
container that emulates the behavior of the technology (Java EE)?</em></p>
</div>
<div class="paragraph">
<p>Nope!It&#8217;s pluggable. It can be your target runtime, such as JBoss AS,
GlassFish or Tomcat. Or it can even been an embedded container such as
OpenEJB, GlassFish Embedded or Weld SE. You can even use one container
for development and another for continuous integration.</p>
</div>
<div class="paragraph">
<p>This portability is made possible by a RPC-style (or local, if
applicable) communication between the test runner and the container, a
real container. You can run the same test case against various
containers and you don&#8217;t get locked into a proprietary test environment.</p>
</div>
<div class="paragraph">
<p>Arquillian recognizes three container interaction styles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>remote container</em> resides in a separate JVM from the test runner.
Arquillian binds to the container to deploy the test archive and invokes
tests via a remote protocol (e.g., Servlet, JMX).</p>
</li>
<li>
<p>A <em>managed container</em> is similar to a remote container, except its
lifecycle (startup/shutdown) is also managed by Arquillian.</p>
</li>
<li>
<p>An <em>embedded container</em> resides in the same JVM and is mostly likely
managed by Arquillian. Tests are executed via a local protocol for
containers without a web component and via a remote protocol for
containers with a web component. No need to fiddle with those Maven
plugins!</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A container is further classified by its capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java EE application server (e.g., JBoss AS, GlassFish, WebLogic)</p>
</li>
<li>
<p>Servlet container (e.g., Tomcat, Jetty)</p>
</li>
<li>
<p>standalone bean container (e.g., OpenEJB, Weld SE)</p>
</li>
<li>
<p>OSGi container</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Arquillian can control a variety of containers out of the box. If the
container you are using isn&#8217;t supported, Arquillian provides an SPI that
allows you to introduce any additional container to the default
collection.</p>
</div>
<div class="sect3">
<h4 id="container-selection"><a class="anchor" href="#container-selection"></a>2.4.1. Container Selection</h4>
<div class="paragraph">
<p><em>How can a single Arquillian test be executed in different containers?
How does Arquillian decide which container to target? And how are both
remote and local invocations supported?</em></p>
</div>
<div class="paragraph">
<p>The answers to these questions touch upon the extensibility of Arquillian.</p>
</div>
<div class="paragraph">
<p><strong>Container selection occurs at runtime</strong>. Arquillian selects the target
container according to which container adapter is available on the
runtime classpath at the time the test is launched. Therefore, you must
include the container adapter as a test-scoped dependency that
corresponds to the container you want to target.</p>
</div>
<div class="paragraph">
<p>Arquillian delegates to an SPI (Service Provider Interface) to handle
starting and stopping the server and deploying and undeploying archives.
In this case, the SPI is the interface
<code>org.jboss.arquillian.spi.client.DeployableContainer</code>. If you recall
from the getting started guide, we added an Arquillian container adapter
according to the target container we wanted to use. That library
contains an implementation of this interface, thus controlling how
Arquillian handles deployment.</p>
</div>
<div class="paragraph">
<p>If you want to add support for another container in Arquillian, you need
to provide an implementation of the <code>DeployableContainer</code> interface.</p>
</div>
<div class="paragraph">
<p>To switch to another container, you just change which container adapter
is on the classpath before running the test.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can only have one container adapter on the classpath at a time. The
execution of the test will be aborted if more than one adapter is
detected.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One way to swap the libraries on the classpath is to manually edit the
dependencies defined in the pom.xml each time. But that’s just tedious.
The recommended approach is to use Maven profiles.</p>
</div>
<div class="paragraph">
<p>Maven profiles allow you to partition your dependencies into groups, one
group for each container adapter and its related artifacts. When running
the tests, you activate one of those groups, which in turn selects a
target container. The profile is activated either using either a
commandline flag (-P) or a preference in the IDE.</p>
</div>
<div class="paragraph">
<p>The <a href="http://arquillian.org/getting_started/">Getting Started Guide</a>
explains how to setup and use Maven profiles for this purpose in more
detail.</p>
</div>
<div class="paragraph">
<p>So far we&#8217;ve covered how a container adapter is selected. It&#8217;s also
possible to configure the container adapter, which we&#8217;ll look at next.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-configuration"><a class="anchor" href="#container-configuration"></a>2.4.2. Container Configuration</h4>
<div class="paragraph">
<p>We&#8217;ve covered how a container gets selected, but how does Arquillian
know how to locate or communicate with the container? That&#8217;s where
configuration comes in.</p>
</div>
<div class="paragraph">
<p>You can come a long way with default values, but at some point you may
need to customize some of the container settings to fit your
environment. Let&#8217;s see how this can be done with Arquillian.</p>
</div>
<div class="paragraph">
<p>Arquillian will look for configuration settings in a file named
<code>arquillian.xml</code> in the root of your classpath. If it exists it will be
auto loaded, else default values will be used. This file is not a
requirement.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s imagine that we&#8217;re working for the company <code>example.com</code> and in
our environment we have two servers; <code>test.example.com</code> and
<code>hudson.example.com</code>. <code>test.example.com</code> is the JBoss instance we use
for our integration tests and <code>hudson.example.com</code> is our continuous
integration server that we want to run our integration suite from. By
default, Arquillian will use localhost, so we need to tell it to use
<code>test.example.com</code> to run the tests. The JBoss AS container by default
use the Servlet protocol, so we have to override the default
configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="tag">&lt;arquillian</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian http://www.jboss.org/schema/arquillian/arquillian_1_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jbossas</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;configuration&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">providerUrl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>jnp://test.example.com:1099<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Servlet 3.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">host</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>test.example.com<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">port</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>8181<span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;/protocol&gt;</span>
    <span class="tag">&lt;/container&gt;</span>

<span class="tag">&lt;/arquillian&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That should do it! Here we use the JBoss AS 6.0 Remote container which
default use the Servlet 3.0 protocol implementation. We override the
default Servlet configuration to say that the http requests for this
container can be executed over <code>test.example.com:8181</code>, but we also need
to configure the container so it knows where to deploy our archives. We
could for example have configured the Servlet protocol to communicate
with a Apache server in front of the JBoss AS Server if we wanted to.
Each container has different configuration options.</p>
</div>
<div class="paragraph">
<p>For a complete overview of all the containers and their configuration
options, see the
<a href="https://docs.jboss.org/author/display/ARQ/Container+adapters">container
adapters</a> appendix.</p>
</div>
</div>
<div class="sect3">
<h4 id="supported-containers"><a class="anchor" href="#supported-containers"></a>2.4.3. Supported Containers</h4>
<div class="paragraph">
<p>Please see the
<a href="https://docs.jboss.org/author/display/ARQ/Container+adapters">container
adapters</a> appendix for a list of supported containers, including details
for how to use and configure them.</p>
</div>
</div>
<div class="sect3">
<h4 id="container-config-runtime-selection"><a class="anchor" href="#container-config-runtime-selection"></a>2.4.4. Container Config Runtime Selection</h4>
<div class="paragraph">
<p>During execution of your Arquillian test-suite, you may have configured
one or more containers with which you need to execute the test suite.
This is usually configured with maven profiles, but in the case where
individual container options need to be specified at runtime to the
target container. This is where you will need to specify configurations
in your arquillian.xml file, and also activate those configurations
using Java system properties.</p>
</div>
<div class="sect4">
<h5 id="_example_arquillian_xml_with_two_container_configurations"><a class="anchor" href="#_example_arquillian_xml_with_two_container_configurations"></a>Example arquillian.xml with two container configurations:</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="tag">&lt;arquillian</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian http://jboss.org/schema/arquillian/arquillian_1_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

   <span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jbossas_managed</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;protocol</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Servlet 3.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">executionType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>MANAGED<span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/protocol&gt;</span>
      <span class="tag">&lt;configuration&gt;</span>
         <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jbossHome</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${project.baseDir}/target/jboss-as-7.1.1.Final/<span class="tag">&lt;/property&gt;</span>
         <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">allowConnectingToRunningServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/configuration&gt;</span>
   <span class="tag">&lt;/container&gt;</span>
   
   <span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jetty</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;configuration&gt;</span>
          <span class="tag">&lt;more</span> <span class="attribute-name">configuration</span><span class="tag">&gt;</span>...<span class="tag">&lt;/more</span> configuration<span class="error">&gt;</span>
      <span class="tag">&lt;/configuration&gt;</span>
   <span class="tag">&lt;/container&gt;</span>
<span class="tag">&lt;/arquillian&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_activating_a_configuration_via_the_command_line"><a class="anchor" href="#_activating_a_configuration_via_the_command_line"></a>Activating a configuration via the command line</h5>
<div class="paragraph">
<p>The -Darquillian.launch system property is what controls arquillian.xml
configuration selection. If you are running tests from Eclipse or
directly from the command like, you should add the -D system property to
your launch configuration or command.</p>
</div>
</div>
<div class="sect4">
<h5 id="_activating_a_configuration_via_maven"><a class="anchor" href="#_activating_a_configuration_via_maven"></a>Activating a configuration via Maven</h5>
<div class="paragraph">
<p>These configurations may be activated in the maven profile using the
Surefire plugin configuration in your container&#8217;s maven profile to set
the 'arquillian.launch' system property for test execution, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;profile&gt;</span>
         <span class="tag">&lt;id&gt;</span>JBOSS_AS_MANAGED_7.X<span class="tag">&lt;/id&gt;</span>
         <span class="tag">&lt;build&gt;</span>
            <span class="tag">&lt;plugins&gt;</span>
               <span class="tag">&lt;plugin&gt;</span>
                  <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
                  <span class="tag">&lt;artifactId&gt;</span>maven-surefire-plugin<span class="tag">&lt;/artifactId&gt;</span>
                  <span class="tag">&lt;configuration&gt;</span>
                     <span class="tag">&lt;systemPropertyVariables&gt;</span>
                        <span class="tag">&lt;arquillian.launch&gt;</span>jbossas_managed<span class="tag">&lt;/arquillian.launch&gt;</span>
                     <span class="tag">&lt;/systemPropertyVariables&gt;</span>
                  <span class="tag">&lt;/configuration&gt;</span>
               <span class="tag">&lt;/plugin&gt;</span>
  ...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_test_enrichers"><a class="anchor" href="#_test_enrichers"></a>2.5. Test Enrichers</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#dependency-injection">Dependency Injection</a></p>
</li>
<li>
<p><a href="#test-case-injection-points">Test Case Injection Points</a></p>
</li>
<li>
<p><a href="#default-enrichers">Default Enrichers</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#resource-injection">Resource Injection</a></p>
</li>
<li>
<p><a href="#ejb-injection">EJB Injection (without CDI support)</a></p>
</li>
<li>
<p><a href="#cdi-injection">CDI Injection</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#active-scopes">Active Scopes</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you use a unit testing framework like JUnit or TestNG, your test
case lives in a world on its own. That makes integration testing pretty
difficult because it means the environment in which the business logic
executes must be self-contained within the scope of the test case
(whether at the suite, class or method level). The bonus of setting up
this environment in the test falls on the developer&#8217;s shoulders.</p>
</div>
<div class="paragraph">
<p>With Arquillian, you no longer have to worry about setting up the
execution environment because that is all handled for you. The test will
either be running in a container or a local CDI environment. But you
still need some way to hook your test into this environment.</p>
</div>
<div class="paragraph">
<p>A key part of in-container integration testing is getting access to the
container-managed components that you plan to test. Using the Java&#8217;s new
operator to instantiate the business class is not suitable in this
testing scenario because it leaves out the declaratives services that
get applied to the component at runtime. We want the real deal.
Arquillian uses test enrichment to give us access to the real deal. The
visible result of test enrichment is injection of container resources
and beans directly into the test class.</p>
</div>
<div class="sect3">
<h4 id="dependency-injection"><a class="anchor" href="#dependency-injection"></a>2.5.1. Dependency Injection</h4>
<div class="paragraph">
<p>Before Arquillian negotiates the execution of the test, it enriches the
test class by satisfying injection points specified declaratively using
annotations.</p>
</div>
<div class="sect4">
<h5 id="test-case-injection-points"><a class="anchor" href="#test-case-injection-points"></a>Test Case Injection Points</h5>
<div class="paragraph">
<p>Injection points are recognized in the following two locations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Field (any visibility)</p>
</li>
<li>
<p><code>@Test</code> method argument</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a field injection in a test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GreeterTestCase</span> {
    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Greeter greeter;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of a method argument injection in a test method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testGreeting(Greeter greeter) {
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>@Inject</code> annotation is not required when injecting into a
method argument.</p>
</div>
</div>
<div class="sect4">
<h5 id="default-enrichers"><a class="anchor" href="#default-enrichers"></a>Default Enrichers</h5>
<div class="paragraph">
<p>There are three injection-based enrichers provided by Arquillian out of
the box:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Resource</code> - Java EE resource injections</p>
</li>
<li>
<p><code>@EJB</code> - EJB session bean reference injections</p>
</li>
<li>
<p><code>@Inject</code>, <code>@Resource</code>, <code>@EJB</code>, <code>@PersistenceContext</code> and
<code>@PersistenceUnit</code> - CDI-supported injections</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first two enrichers use JNDI to lookup the instance to inject. The
CDI injections are handled by treating the test class as a bean capable
of receiving standard CDI injections (non-contextual injection). Since
CDI requires containers to satisfy all Java EE injection points on a CDI
bean, the <code>@Resource</code>, <code>@EJB</code>, <code>@PersistenceContext</code> and
<code>@PersistenceUnit</code> injections are supported transitively by the CDI
enricher. In fact, because of CDI&#8217;s tight integration with the
container, <code>@EJB</code> injections in the test class are satisfied according
to specification when the CDI enricher is available.</p>
</div>
<div class="sect5">
<h6 id="resource-injection"><a class="anchor" href="#resource-injection"></a>Resource Injection</h6>
<div class="paragraph">
<p>The <code>@Resource</code> annotation gives you access to any object which is
available via JNDI. It follows the standard rules for <code>@Resource</code> (as
defined in the Section 2.3 of the Common Annotations for the Java
Platform specification).</p>
</div>
</div>
<div class="sect5">
<h6 id="ejb-injection"><a class="anchor" href="#ejb-injection"></a>EJB Injection (without CDI support)</h6>
<div class="paragraph">
<p>The <code>@EJB</code> annotation performs a JNDI lookup for the EJB session bean
reference using the following equation in the specified order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/test.ear/test/</span><span class="delimiter">&quot;</span></span> + fieldType.getSimpleName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">Bean</span><span class="delimiter">&quot;</span></span>,
<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/test.ear/test/</span><span class="delimiter">&quot;</span></span> + fieldType.getSimpleName(),
<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/test/</span><span class="delimiter">&quot;</span></span> + fieldType.getSimpleName(),
<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/test/</span><span class="delimiter">&quot;</span></span> + fieldType.getSimpleName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">Bean</span><span class="delimiter">&quot;</span></span>,
<span class="string"><span class="delimiter">&quot;</span><span class="content">java:global/test/</span><span class="delimiter">&quot;</span></span> + fieldType.getSimpleName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">/no-interface</span><span class="delimiter">&quot;</span></span>,
<span class="string"><span class="delimiter">&quot;</span><span class="content">test/</span><span class="delimiter">&quot;</span></span> + unqualified <span class="type">interface</span> <span class="class">name</span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">Bean/local</span><span class="delimiter">&quot;</span></span>,
<span class="string"><span class="delimiter">&quot;</span><span class="content">test/</span><span class="delimiter">&quot;</span></span> + unqualified <span class="type">interface</span> <span class="class">name</span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">Bean/remote</span><span class="delimiter">&quot;</span></span>,
<span class="string"><span class="delimiter">&quot;</span><span class="content">test/</span><span class="delimiter">&quot;</span></span> + unqualified <span class="type">interface</span> <span class="class">name</span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">/no-interface</span><span class="delimiter">&quot;</span></span>,
unqualified <span class="type">interface</span> <span class="class">name</span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">Bean/local</span><span class="delimiter">&quot;</span></span>,
unqualified <span class="type">interface</span> <span class="class">name</span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">Bean/remote</span><span class="delimiter">&quot;</span></span>,
unqualified <span class="type">interface</span> <span class="class">name</span> + <span class="string"><span class="delimiter">&quot;</span><span class="content">/no-interface</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If no matching beans were found in those locations the injection will
fail.</p>
</div>
<div class="paragraph">
<p>At the moment, the lookup for an EJB session reference relies on some
common naming convention of EJB beans. In the future the lookup will
rely on the standard JNDI naming conventions established in Java EE 6.</p>
</div>
</div>
<div class="sect5">
<h6 id="cdi-injection"><a class="anchor" href="#cdi-injection"></a>CDI Injection</h6>
<div class="paragraph">
<p>In order for CDI injections to work, the test archive defined with
ShrinkWrap must be in a bean archive. That means adding beans.xml to the
META-INF directory. Here&#8217;s a <code>@Deployment</code> method that shows one way to
add a beans.xml to the archive:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Deployment</span>
<span class="directive">public</span> <span class="directive">static</span> JavaArchive createTestArchive() {
   <span class="keyword">return</span> ShrinkWrap.create(JavaArchive.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">test.jar</span><span class="delimiter">&quot;</span></span>)
      .addClass(NameOfClassUnderTest.class)
      .addAsManifestResource(EmptyAsset.INSTANCE, Paths.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>In an application that takes full advantage of CDI, you can likely get
by only using injections defined with the <code>@Inject</code> annotation.
Regardless, the other two types of injection come in handy from
time-to-time.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="active-scopes"><a class="anchor" href="#active-scopes"></a>2.5.2. Active Scopes</h4>
<div class="paragraph">
<p>When running your tests the embedded Weld EE container, Arquillian
activates scopes as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application scope - Active for all methods in a test class</p>
</li>
<li>
<p>Session scope - Active for all methods in a test class</p>
</li>
<li>
<p>Request scope - Active for a single test method</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Scope control is experimental at this point and may be altered in a
future release of Arquillian.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_additional_features"><a class="anchor" href="#_additional_features"></a>2.6. Additional Features</h3>
<div class="paragraph">
<p>This chapter walks through the following additional features that Arquillian
provides to address more advanced use cases. These features may even allow you to
write tests for scenarios you previously classified as too difficult to
test.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#test-run-modes">Test Run Modes</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#container-mode">Container Mode</a></p>
</li>
<li>
<p><a href="#client-mode">Client Mode</a></p>
</li>
<li>
<p><a href="#mixed-mode">Mixed Mode</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#descriptor-deployment">Descriptor Deployment</a></p>
</li>
<li>
<p><a href="#arquillian-resource-injection">Arquillian Resource Injection</a></p>
</li>
<li>
<p><a href="#multiple-deployments">Multiple Deployments</a></p>
</li>
<li>
<p><a href="#multiple-containers">Multiple Containers</a></p>
</li>
<li>
<p><a href="#protocol-selection">Protocol Selection</a></p>
</li>
<li>
<p><a href="#enabling-assertions">Enabling Assertions</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="test-run-modes"><a class="anchor" href="#test-run-modes"></a>2.6.1. Test Run Modes</h4>
<div class="paragraph">
<p>So far, we&#8217;ve focused on testing your application internals, but we also
want to test how others (people, or other programs) interact with the
application. Typically, you want to make sure that every use case and
execution path is fully tested. Third parties can interact with your
application in a number of ways, for example web services, remote EJBs
or via http. You need to check that you object serialization or
networking work for instance.</p>
</div>
<div class="paragraph">
<p>This is why Arquillian comes with two run modes, <code>in container</code> and
<code>as client</code>. <code>in container</code> is to test your application internals and
<code>as client</code> is to test how your application is used by clients. Lets
dive a bit deeper into the differences between the run modes and see how
they effect your test execution and packaging.</p>
</div>
<div class="sect4">
<h5 id="container-mode"><a class="anchor" href="#container-mode"></a>Container mode: @Deployment(testable = true)</h5>
<div class="paragraph">
<p>As we mentioned above, we need to repackage your <code>@Deployment</code>, adding
some Arquillian support classes, to run in-container. This gives us the
ability to communicate with the test, enrich the test and run the test
remotely. In this mode, the test executes in the remote container.</p>
</div>
<div class="paragraph">
<p><em>Arquillian uses this mode by default.</em></p>
</div>
<div class="paragraph">
<p>See the Complete Protocol Reference for an overview of the expected
output of the packaging process when you provide a <code>@Deployment</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="client-mode"><a class="anchor" href="#client-mode"></a>Client mode: @Deployment(testable = false)</h5>
<div class="paragraph">
<p>Now this mode is the easy part. As opposed to in-container mode which
repackages and overrides the test execution, the as-client mode does as
little as possible. It does not repackage your <code>@Deployment</code> nor does it
forward the test execution to a remote server. Your test case is running
in your JVM as expected and you&#8217;re free to test the container from the
outside, as your clients see it. The only thing Arquillian does is to
control the lifecycle of your <code>@Deployment</code>.</p>
</div>
<div class="paragraph">
<p>Here is an example calling a Servlet using the <code>as client</code> mode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">LocalRunServletTestCase</span> {
    <span class="annotation">@Deployment</span>(testable = <span class="predefined-constant">false</span>)
    <span class="directive">public</span> <span class="directive">static</span> WebArchive createDeployment() {
        <span class="keyword">return</span> ShrinkWrap.create(WebArchive.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">test.war</span><span class="delimiter">&quot;</span></span>)
                .addClass(TestServlet.class);
   }

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> shouldBeAbleToCallServlet(<span class="annotation">@ArquillianResource</span>(TestServlet.class) <span class="predefined-type">URL</span> baseUrl) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">String</span> body = readAllAndClose(<span class="keyword">new</span> <span class="predefined-type">URL</span>(baseUrl, <span class="string"><span class="delimiter">&quot;</span><span class="content">/Test</span><span class="delimiter">&quot;</span></span>).openStream());
        Assert.assertEquals(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">Verify that the servlet was deployed and returns the expected result</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>,
            body);
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="mixed-mode"><a class="anchor" href="#mixed-mode"></a>Mixed mode</h5>
<div class="paragraph">
<p>It is also possible to mix the two run modes within the same test class.
If you have defined the <code>Deployment</code> to be testable, you can specify the
<code>@Test</code> method to use run mode <code>as client</code> by using the <code>@RunAsClient</code>
annotation. This will allow two method within the same test class to run
in different modes. This can be useful if you in a run <code>as client</code> mode
want to execute against a remote endpoint in your application, for then
in the next test method assert on server side state the remote endpoint
might have created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Deployment</span>(testable = <span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="directive">static</span> WebArchive create() {
   ...
}

<span class="annotation">@Test</span> <span class="comment">// runs in container</span>
<span class="directive">public</span> <span class="type">void</span> shouldBeAbleToRunOnContainerSide() <span class="directive">throws</span> <span class="exception">Exception</span> {
   ...
}

<span class="annotation">@Test</span> <span class="annotation">@RunAsClient</span> <span class="comment">// runs as client</span>
<span class="directive">public</span> <span class="type">void</span> shouldBeAbleToRunOnClientSide() <span class="directive">throws</span> <span class="exception">Exception</span> {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The effect of the different run modes depend on the
<code>DeployableContainer</code> used. Both modes might seem to behave the same in
some Embedded containers, but you should avoid mixing your internal and
external tests. One thing is that they should test different aspects of
your application and different use-cases, another is that you will miss
the benefits of switching <code>DeployableContainers</code> and run the same tests
suite against a remote server if you do.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="descriptor-deployment"><a class="anchor" href="#descriptor-deployment"></a>2.6.2. Descriptor Deployment</h4>
<div class="paragraph">
<p>We have previously seen Arquillian deploys ShrinkWrap Archives, but some
times you need to deploy other items like a JMS Queue or a DataSource
for your test to run. This can be done by using a ShrinkWrap sub project
called ShrinkWrap Descriptors. Just like you would deploy an <code>Archive</code>
you can deploy a <code>Descriptor</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Deployment</span>(order = <span class="integer">1</span>)
<span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">Descriptor</span> createDep1()
{
  <span class="keyword">return</span> Descriptors.create(DataSourceDescriptor.class);
}

<span class="annotation">@Deployment</span>(order = <span class="integer">2</span>)
<span class="directive">public</span> <span class="directive">static</span> WebArchive createDep2() {}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testDataBase() {}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="arquillian-resource-injection"><a class="anchor" href="#arquillian-resource-injection"></a>2.6.3. Arquillian Resource Injection</h4>
<div class="paragraph">
<p>When dealing with multiple different environments and hidden dynamic
container configuration you very soon come to a point where you need
access to the backing containers ip/port/context information. This is
especially useful when doing remote end point testing. So instead of
trying to setup all containers on the same ip/port/context, or hard code
this in your test, Arquillian provides something we call
<code>@ArquillianResource</code> injection. Via this injection point we can expose
multiple internal objects.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Note that <code>@ArquillianResource</code> injection of URLs is only supported
for in-container tests since Arquillian version 1.1.9.Final
(see https://issues.jboss.org/browse/ARQ-540[ARQ-540]).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you need to get a hold of the request URI (up through the context
path) your <code>Deployment</code> defined, e.g. "http://localhost:8080/test", you
can use <code>@ArquillianResource</code> on a field or method argument of type URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ArquillianResource</span>
<span class="directive">private</span> <span class="predefined-type">URL</span> baseURL;

<span class="annotation">@Test</span>
<span class="directive">private</span> <span class="type">void</span> shouldDoX(<span class="annotation">@ArquillianResource</span> <span class="predefined-type">URL</span> baseURL)
{
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are deploying an EAR with multiple WARs, and you&#8217;ve deployed a
given servlet to just one of them, you can provide the servlet&#8217;s class
to get the request URI up through the context path for the WAR that
contains that servlet, e.g. "http://localhost:8080/test1" vs.
"http://localhost:8080/test2":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ArquillianResource</span>(MyServlet.class)
<span class="directive">private</span> <span class="predefined-type">URL</span> baseURL;

<span class="annotation">@Test</span>
<span class="directive">private</span> <span class="type">void</span> shouldDoX(<span class="annotation">@ArquillianResource</span>(MyServlet.class) <span class="predefined-type">URL</span> baseURL)
{
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that this version does not return the request URI to the given
servlet, e.g. "http://localhost:8080/test2/MyServlet", but again just
the request URI up through the context path.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="multiple-deployments"><a class="anchor" href="#multiple-deployments"></a>2.6.4. Multiple Deployments</h4>
<div class="paragraph">
<p>Sometimes a single <code>Deployment</code> is not enough, and you need to specify
more then one to get your test done.</p>
</div>
<div class="paragraph">
<p><em>Maybe you want to test communication between two different web applications?</em></p>
</div>
<div class="paragraph">
<p>Arquillian supports this as well. Simple just add more <code>@Deployment</code> methods
to the test class and your done. You can use the <code>@Deployment.order</code> if they
need to be deployed in a specific order. When dealing with multiple in
container deployments you need to specify which <code>Deployment</code> context the
individual test methods should run in. You do this by adding a name to
the deployment by using the <code>@Deployment.name</code> and refer to that name on
the test method by adding <code>@OperateOnDeployment("deploymentName")</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Deployment</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dep1</span><span class="delimiter">&quot;</span></span>, order = <span class="integer">1</span>)
<span class="directive">public</span> <span class="directive">static</span> WebArchive createDep1() {}

<span class="annotation">@Deployment</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dep2</span><span class="delimiter">&quot;</span></span>, order = <span class="integer">2</span>)
<span class="directive">public</span> <span class="directive">static</span> WebArchive createDep2() {}

<span class="annotation">@Test</span> <span class="annotation">@OperateOnDeployment</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">dep1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> testRunningInDep1() {}

<span class="annotation">@Test</span> <span class="annotation">@OperateOnDeployment</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">dep2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> testRunningInDep2() {}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="multiple-containers"><a class="anchor" href="#multiple-containers"></a>2.6.5. Multiple Containers</h4>
<div class="paragraph">
<p>There are times when you need to involve multiple containers in the same
test case, if you for instance want to test clustering. The first step
you need to take is to add a <code>group</code> with multiple containers to your
Arquillian configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<span class="tag">&lt;arquillian</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://jboss.org/schema/arquillian http://jboss.org/schema/arquillian/arquillian_1_0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;group</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tomcat-cluster</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container-1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;configuration&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tomcatHome</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>target/tomcat-embedded-6-standby<span class="tag">&lt;/property&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">workDir</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>work<span class="tag">&lt;/property&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bindHttpPort</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>8880<span class="tag">&lt;/property&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unpackArchive</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/container&gt;</span>
        <span class="tag">&lt;container</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container-2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;configuration&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tomcatHome</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>target/tomcat-embedded-6-active-1<span class="tag">&lt;/property&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">workDir</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>work<span class="tag">&lt;/property&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bindHttpPort</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>8881<span class="tag">&lt;/property&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unpackArchive</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
            <span class="tag">&lt;/configuration&gt;</span>
        <span class="tag">&lt;/container&gt;</span>
    <span class="tag">&lt;/group&gt;</span>
<span class="tag">&lt;/arquillian&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So what we have done here is to say we have two containers that
Arquillian will control, container-1 and container-2. Arquillian will
now instead of starting up one container, which is normal, start up two.
In your test class you can target different deployments against the
different containers using the <code>@TargetsContainer("containerName")</code>
annotation on your <code>Deployment</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Deployment</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dep1</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@TargetsContainer</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">container-1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">static</span> WebArchive createDep1() {}

<span class="annotation">@Deployment</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dep2</span><span class="delimiter">&quot;</span></span>)  <span class="annotation">@TargetsContainer</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">container-2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">static</span> WebArchive createDep2() {}

<span class="annotation">@Test</span> <span class="annotation">@OperateOnDeployment</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">dep1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> testRunningInDep1() {}

<span class="annotation">@Test</span> <span class="annotation">@OperateOnDeployment</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">dep2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> testRunningInDep2() {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We now have a single test class that will be executed in two different
containers. <code>testRunningInDep1</code> will operate in the context of the
<code>dep1</code> deployment which is deployed on the container named <code>container-1</code>
and <code>testRunningInDep2</code> will operate in the context of deployment <code>dep2</code>
which is deployed on container <code>container-2</code>. As the test moves along,
each method is executed inside the individual containers.</p>
</div>
<div class="paragraph">
<p>Arquillian does not support ClassLoader isolation on the client side so
for this feature to work the container adapter must support running
multiple instances within the same ClassLoader/JVM. Currently this only
works with containers of type Remote or Managed as the adapter normally
will connect to an isolated server started in its own JVM.</p>
</div>
</div>
<div class="sect3">
<h4 id="protocol-selection"><a class="anchor" href="#protocol-selection"></a>2.6.6. Protocol Selection</h4>
<div class="paragraph">
<p>A protocol is how Arquillian talks and executes the tests inside the
container. For ease of development and configuration a container defines
a default protocol that will be used if no other is specified. You can
override this default behavior by defining the <code>@OverProtocol</code>
annotation on your <code>@Deployment</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Deployment</span> <span class="annotation">@OverProtocol</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyCustomProtocol</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="directive">static</span> WebArchive createDep1() {}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> testExecutedUsingCustomProtocol() {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>testExecutedUsingCustomProtocol</code> is executed, instead of using the
containers protocol which is defined by default, Arquillian will use
<code>MyCustomProtocol</code> to communicate with the container. Since this is
defined on <code>Deployment</code> level, you can have different test methods which
operate on different deployments and therefore being executed using
different protocols. This can be useful when for instance a protocols
packaging requirements hinder how you define your archive, or you simply
can not communicate with the container using the default protocol due to
e.g. firewall settings.</p>
</div>
<div class="paragraph">
<p>Arquillian only supports Servlet 2.5 and Servlet 3.0 at this time. EJB
3.0 and 3.1 are planned. But you might implement your own Protocol. For
doing this, please see the Complete Protocol Reference for the better
knowing what is currently supported.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-assertions"><a class="anchor" href="#enabling-assertions"></a>2.6.7. Enabling Assertions</h4>
<div class="paragraph">
<p>The first time you try Arquillian, you may find that assertions that use
the Java assert keyword are not working. Keep in mind that the test is
not executing the same JVM as the test runner.</p>
</div>
<div class="paragraph">
<p>In order for the Java keyword "assert" to work you have to enable
assertions (using the -ea flag) in the JVM that is running the
container. You may want to consider specifying the package names of your
test classes to avoid assertions to be enabled throughout the
container&#8217;s source code.</p>
</div>
<div class="sect4">
<h5 id="enabling-assertions-in-jboss-as"><a class="anchor" href="#enabling-assertions-in-jboss-as"></a>Enabling Assertions In JBoss AS</h5>
<div class="paragraph">
<p>If you are using JBoss AS, the quickest way to setup debug mode is to
add the following line to the end of $JBOSS_AS_HOME/bin/run.conf
(Unix/Linux):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">JAVA_OPTS=<span class="string"><span class="delimiter">&quot;</span><span class="content">$JAVA_OPTS -ea</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or before the line :JAVA_OPTS_SET in $JBOSS_AS_HOME/bin/run.conf.bat
(Windows)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">set <span class="string"><span class="delimiter">&quot;</span><span class="content">JAVA_OPTS=%JAVA_OPTS% -ea</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind your container will always run with assertions enabled
after making this change. You might want to consider putting some logic
in the run.conf* file.</p>
</div>
<div class="paragraph">
<p>As an alternative, we recommend using the 'Assert' object that comes
with your test framework instead to avoid the whole issue. Also keep in
mind that if you use System.out.println statements, the output is going
to show up in the log file of the container rather than in the test
output.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_protocols"><a class="anchor" href="#_protocols"></a>2.7. Protocols</h3>
<div class="paragraph">
<p>In order to support running the same test locally and in remote
containers, Arquillian uses an SPI that controls which protocol is used
to negotiate execution of the test. This appendix details the default
protocols that Arquillian provides, when they are used and how they can
be configured.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#local">Local</a></p>
</li>
<li>
<p><a href="#servlet-2.5">Servlet 2.5</a></p>
</li>
<li>
<p><a href="#servlet-3.0">Servlet 3.0</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="local"><a class="anchor" href="#local"></a>2.7.1. Local</h4>
<div class="paragraph">
<p>The Local Protocol implementation is used by most EE5 compliant
containers. It does nothing to the deployment. The Local Protocol is also
used when executing in run mode <code>as client</code>.</p>
</div>
<div class="paragraph">
<p><strong>Packaging rules</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">@Deployment</th>
<th class="tableblock halign-left valign-top">Output</th>
<th class="tableblock halign-left valign-top">Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does nothing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does nothing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnterpriseArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnterpriseArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does nothing.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h5>
<div class="paragraph">
<p><strong>Protocol Configuration Options</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
</table>
</div>
</div>
<div class="sect3">
<h4 id="servlet-2.5"><a class="anchor" href="#servlet-2.5"></a>2.7.2. Servlet 2.5</h4>
<div class="paragraph">
<p>The Servlet 2.5 Protocol implementation is used by most EE5 compliant
containers. It will attempt to add a war to the deployment.</p>
</div>
<div class="paragraph">
<p><strong>Packaging rules</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">@Deployment</th>
<th class="tableblock halign-left valign-top">Output</th>
<th class="tableblock halign-left valign-top">Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnterpriseArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create a new <code>EnterpriseArchive</code>, add <code>@Deployment</code> and
 <code>ServletProtocol</code> as module, the other <code>Auxiliary Archives</code> as
 libraries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a web.xml is found, a Servlet will be added, else a web.xml will be
 added. The Servlet <code>WebArchive</code> will be merged with the Deployment and
 the <code>Auxiliary Archives</code> added as libraries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnterpriseArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnterpriseArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as <code>JavaArchive</code>, but using the <code>@Deployment</code> defined
 <code>EnterpriseArchive</code> instead of creating a new.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>Configuration</h5>
<div class="paragraph">
<p><strong>Protocol Configuration Options</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to override the Deployments default hostname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to override the Deployments default http port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextRoot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to override the Deployments default contextRoot.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="servlet-3.0"><a class="anchor" href="#servlet-3.0"></a>2.7.3. Servlet 3.0</h4>
<div class="paragraph">
<p>The Servlet 3.0 Protocol implementation is used by most EE6 compliant
containers. It will attempt to add a web-fragment to the deployment.</p>
</div>
<div class="paragraph">
<p><strong>Packaging rules</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">@Deployment</th>
<th class="tableblock halign-left valign-top">Output</th>
<th class="tableblock halign-left valign-top">Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a new <code>WebArchive</code>, adds <code>@Deployment</code> and <code>Auxiliary Archives</code>
 as libraries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WebArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds <code>@Deployment</code> and <code>Auxiliary Archives</code> as libraries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnterpriseArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EnterpriseArchive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a single <code>WebArchive</code> is found, the same as for <code>WebArchive</code> is done.
 If no <code>WebArchives</code> are found a new one is created, adds <code>@Deployment</code>
 and <code>Auxiliary Archives</code> as libraries. If multiple <code>WebArchives</code> are
 found, a exception is thrown.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>Configuration</h5>
<div class="paragraph">
<p><strong>Protocol Configuration Options</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to override the Deployments default hostname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to override the Deployments default http port.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contextRoot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to override the Deployments default contextRoot.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_integration"><a class="anchor" href="#_build_integration"></a>2.8. Build Integration</h3>
<div class="paragraph">
<p>Just because the Arquillian project uses Maven doesn&#8217;t mean you have to
use it to run your Arquillian tests. Arquillian is designed to have
seamless integration with JUnit and TestNG without any necessary test
framework configuration. That means you can use any build system that
has a JUnit or TestNG task to execute your Arquillian test cases. Since
most of this guide focuses on using Arquillian in a <a href="#maven">Maven</a> build, this
chapter is going to be about alternative build systems, namely <a href="#gradle">Gradle</a>
and <a href="#ant">Ant</a>.</p>
</div>
<div class="sect3">
<h4 id="_active_build_ingredient"><a class="anchor" href="#_active_build_ingredient"></a>2.8.1. Active Build Ingredient</h4>
<div class="paragraph">
<p>The secret ingredient required to activate the Arquillian test runner is
getting the correct libraries on the classpath. (Often easier said than
done). The libraries consist of the Arquillian container integration and
the container runtime (for an embedded container) or deployment client
(for a remote container).</p>
</div>
<div class="paragraph">
<p>In general, the steps to incorporate Arquillian into a build, regardless
of what build tool you are using, can be summarized as:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Activate/configure the JUnit or TestNG task/plugin</p>
</li>
<li>
<p>Add the Arquillian container integration to the test classpath
(e.g.,
org.jboss.arquillian.container:arquillian-%VENDOR%-%TYPE%-%VERSION%)</p>
</li>
<li>
<p>Add the container runtime (embedded) or deployment client (remote)
to the classpath</p>
</li>
<li>
<p>Execute the test build task/goal</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you are only running the Arquillian tests on a single container, this
setup is exceptionally straightforward. The challenge comes when you
want to run the tests on multiple containers. It&#8217;s really just a matter
of putting the correct libraries on the test classpath, though.</p>
</div>
<div class="paragraph">
<p>For some build systems, isolating multiple classpath definitions is more
tricky than others. For instance, in Maven, you only get one test
classpath per run (without using really advanced plugin configuration).
You can toggle between different test classpath pairings through the use
of profiles. Each profile contains the libraries for a single target
container (a combination of the libraries itemized in steps 2 and 3
above). You&#8217;ll see this strategy used in the Arquillian examples.</p>
</div>
<div class="paragraph">
<p>Other build tools, such as Gradle, can easily define new test tasks that
each have their own, unique classpath. This makes it not only possible
to separate out the target containers, but also run the tests against
each one in the same build execution. We&#8217;ll see an example of that later
in this chapter. Gradle can also emulate the Maven profile strategy
through the use of build fragment imports. We&#8217;ll also show an example of
that approach for contrast.</p>
</div>
</div>
<div class="sect3">
<h4 id="maven"><a class="anchor" href="#maven"></a>2.8.2. Maven</h4>
<div class="paragraph">
<p>The community has gravitated towards Maven as the preferred build tool
for projects that use Arquillian. Details on how to setup Arquillian in
a Maven project is covered in detail in the
<a href="http://arquillian.org/guides/">Arquillian Guides</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="gradle"><a class="anchor" href="#gradle"></a>2.8.3. Gradle</h4>
<div class="paragraph">
<p><a href="http://gradle.org">Gradle</a> is a build tool that allows you to create
declarative, maintainable, concise and highly-performing builds. More
importantly, in this context, Gradle gives you all the freedom you need
instead of imposing a rigid build lifecycle on you. You&#8217;ll get a glimpse
of just how flexible Gradle can be by learning how to integrate
Arquillian into a Gradle build.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll be contrasting two strategies for running Arquillian tests from
Gradle:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Container-specific test tasks</p>
</li>
<li>
<p>Test "profiles" via build fragment imports</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first strategy is the recommended one since it gives you the benefit
of being able to run your tests on multiple containers in the same
build. However, the second approach is less esoteric and will be more
familiar to Maven users. Of course, Gradle is so flexible that there are
likely other solutions for this problem. We invite you to give us
feedback if you find a better way (or another way worth documenting).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s get the common build stuff out of the way, then dive into the two
strategies listed above.</p>
</div>
<div class="sect4">
<h5 id="_apply_from_common"><a class="anchor" href="#_apply_from_common"></a>apply from: common</h5>
<div class="paragraph">
<p>The simplest Gradle build for a Java project is a sparse one line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: JavaPlugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Put this line into a file named build.gradle at the root of the project,
which is the standard location of the Gradle build file. (Perhaps after
seeing this configuration you&#8217;ll understand the reference in the section
title).</p>
</div>
<div class="paragraph">
<p>Next we&#8217;ll add the Maven Central and JBoss Community repository
definitions, so that we can pull down dependent libraries. The latter
repository hosts the Arquillian artifacts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: JavaPlugin

repositories {
   mavenCentral()
   mavenRepo urls: <span class="string"><span class="delimiter">'</span><span class="content">http://repository.jboss.org/nexus/content/groups/public</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your SCM (e.g., SVN, Git) is already ignoring the target directory,
you may want to move the Gradle build output underneath this folder,
rather than allowing Gradle to use it&#8217;s default build directory, build.
Let&#8217;s add that configuration to the common build logic as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: JavaPlugin

buildDir = <span class="string"><span class="delimiter">'</span><span class="content">target/gradle-build</span><span class="delimiter">'</span></span>

repositories {
   mavenCentral()
   mavenRepo urls: <span class="string"><span class="delimiter">'</span><span class="content">http://repository.jboss.org/nexus/content/groups/public</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using Gradle alongside Maven, you shouldn&#8217;t set the buildDir
to target since Gradle organizes compiled classes different than Maven
does, possibly leading to conflicts (Though, the behavior of Gradle can
also be customized).</p>
</div>
<div class="paragraph">
<p>We also recommend that you centralize version numbers at the top of your
build to make upgrading your dependency easy. This list will grow as you
add other containers, but we&#8217;ll seed the list for the examples below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: JavaPlugin

buildDir = <span class="string"><span class="delimiter">'</span><span class="content">target/gradle-build</span><span class="delimiter">'</span></span>

libraryVersions = [
   junit: <span class="string"><span class="delimiter">'</span><span class="content">4.8.1</span><span class="delimiter">'</span></span>, arquillian: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Alpha4</span><span class="delimiter">'</span></span>, jbossJavaeeSpec: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Beta7</span><span class="delimiter">'</span></span>, weld: <span class="string"><span class="delimiter">'</span><span class="content">1.0.1-Final</span><span class="delimiter">'</span></span>,
   slf4j: <span class="string"><span class="delimiter">'</span><span class="content">1.5.8</span><span class="delimiter">'</span></span>, log4j: <span class="string"><span class="delimiter">'</span><span class="content">1.2.14</span><span class="delimiter">'</span></span>, jbossas: <span class="string"><span class="delimiter">'</span><span class="content">6.0.0.Final</span><span class="delimiter">'</span></span>, glassfish: <span class="string"><span class="delimiter">'</span><span class="content">3.0.1-b20</span><span class="delimiter">'</span></span>, cdi: <span class="string"><span class="delimiter">'</span><span class="content">1.0-SP1</span><span class="delimiter">'</span></span>
]

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also need to add the unit test library (JUnit or TestNG) and the
corresponding Arquillian integration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dependencies {
   testCompile group: <span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>, version: libraryVersions.junit
   testCompile group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-junit</span><span class="delimiter">'</span></span>, version: libraryVersions.arquillian
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we&#8217;ll assume the project is compiling against APIs that
are provided by the target container runtime, so we need to add a
dependency configuration (aka scope) to include libraries on the compile
classpath but excluded from the runtime classpath. In the future, Gradle
will include support for such a scope. Until then, we&#8217;ll define one
ourselves in the configurations closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">configurations {
   compileOnly
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also need to add the dependencies associated with that configuration
to the compile classpaths using the sourceSets closure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">sourceSets {
   main {
      compileClasspath = configurations.compile + configurations.compileOnly
   }
   test {
      compileClasspath = compileClasspath + configurations.compileOnly
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the Gradle build all together now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: JavaPlugin

buildDir = <span class="string"><span class="delimiter">'</span><span class="content">target/gradle-build</span><span class="delimiter">'</span></span>

libraryVersions = [
   junit: <span class="string"><span class="delimiter">'</span><span class="content">4.8.1</span><span class="delimiter">'</span></span>, arquillian: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Alpha3</span><span class="delimiter">'</span></span>, jbossJavaeeSpec: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Beta7</span><span class="delimiter">'</span></span>, weld: <span class="string"><span class="delimiter">'</span><span class="content">1.0.1-Final</span><span class="delimiter">'</span></span>,
   slf4j: <span class="string"><span class="delimiter">'</span><span class="content">1.5.8</span><span class="delimiter">'</span></span>, log4j: <span class="string"><span class="delimiter">'</span><span class="content">1.2.14</span><span class="delimiter">'</span></span>, jbossas: <span class="string"><span class="delimiter">'</span><span class="content">6.0.0.Final</span><span class="delimiter">'</span></span>, glassfish: <span class="string"><span class="delimiter">'</span><span class="content">3.0.1-b20</span><span class="delimiter">'</span></span>, cdi: <span class="string"><span class="delimiter">'</span><span class="content">1.0-SP1</span><span class="delimiter">'</span></span>
]

repositories {
   mavenCentral()
   mavenRepo urls: <span class="string"><span class="delimiter">'</span><span class="content">http://repository.jboss.org/nexus/content/groups/public</span><span class="delimiter">'</span></span>
}

configurations {
   compileOnly
}

sourceSets {
   main {
      compileClasspath = configurations.compile + configurations.compileOnly
   }
   test {
      compileClasspath = compileClasspath + configurations.compileOnly
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that the foundation of a build is in place (or you&#8217;ve added these
elements to your existing Gradle build), we are ready to configuring the
container-specific test tasks. In the first approach, we&#8217;ll create a
unique dependency configuration and task for each container.</p>
</div>
</div>
<div class="sect4">
<h5 id="_strategy_1_container_specific_test_tasks"><a class="anchor" href="#_strategy_1_container_specific_test_tasks"></a>Strategy #1: Container-Specific Test Tasks</h5>
<div class="paragraph">
<p>Each project in Gradle is made up of one or more tasks. A task
represents some atomic piece of work which a build performs. Examples
include compiling classes, <em>executing tests</em>, creating a JAR,
publishing an artifact to a repository. We are interested in the
executing tests task. But it&#8217;s not necessarily just a single test task.
Gradle allows you to define any number of test tasks, each having its
own classpath configuration. We&#8217;ll use this to configure test executions
for each container.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume that we want to run the tests against the following three
Arquillian-supported containers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Weld EE Embedded 1.1</p>
</li>
<li>
<p>Remote JBoss AS 6</p>
</li>
<li>
<p>Embedded GlassFish 3</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ll need three components for each container:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Dependency configuration (scope)</p>
</li>
<li>
<p>Runtime dependencies</p>
</li>
<li>
<p>Custom test task</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We&#8217;ll start with the Weld EE Embedded container. Starting from the
Gradle build defined in the previous section, we first define a
configuration for the test runtime dependencies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">configurations {
   compileOnly
   weldEmbeddedTestRuntime { extendsFrom testRuntime }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we add the dependencies for compiling against the Java EE API and
running Arquillian tests in the Weld EE Embedded container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dependencies {
   compileOnly group: <span class="string"><span class="delimiter">'</span><span class="content">javax.enterprise</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">cdi-api</span><span class="delimiter">'</span></span>, version: libraryVersions.cdi

   testCompile group: <span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>, version: libraryVersions.junit
   testCompile group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-junit</span><span class="delimiter">'</span></span>, version: libraryVersions.arquillian

   <span class="comment">// temporarily downgrade the weld-ee-embedded-1.1 container</span>
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian.container</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-weld-ee-embedded-1.1</span><span class="delimiter">'</span></span>, version: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Alpha3</span><span class="delimiter">'</span></span>
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.spec</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">jboss-javaee-6.0</span><span class="delimiter">'</span></span>, version: libraryVersions.jbossJavaeeSpec
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.weld</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">weld-core</span><span class="delimiter">'</span></span>, version: libraryVersions.weld
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.slf4j</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">slf4j-log4j12</span><span class="delimiter">'</span></span>, version: libraryVersions.slf4j
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">log4j</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">log4j</span><span class="delimiter">'</span></span>, version: libraryVersions.log4j
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we define the test task:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">task weldEmbeddedTest(type: Test) {
   testClassesDir = sourceSets.test.classesDir
   classpath = sourceSets.test.classes + sourceSets.main.classes + configurations.weldEmbeddedTestRuntime
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This task will execute in the lifecycle setup by the Java plugin in
place of the normal test task. You run it as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">gradle weldEmbeddedTest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, more simply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">gradle wET</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we just repeat this setup for the other containers.</p>
</div>
<div class="paragraph">
<p>Since you are creating custom test tasks, you likely want to configure
the default test task to either exclude Arquillian tests are to use a
default container, perhaps Weld EE Embedded in this case.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the full build file with the tasks for our three target
containers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: JavaPlugin

buildDir = <span class="string"><span class="delimiter">'</span><span class="content">target/gradle-build</span><span class="delimiter">'</span></span>

libraryVersions = [
   junit: <span class="string"><span class="delimiter">'</span><span class="content">4.8.1</span><span class="delimiter">'</span></span>, arquillian: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Alpha4</span><span class="delimiter">'</span></span>, jbossJavaeeSpec: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Beta7</span><span class="delimiter">'</span></span>, weld: <span class="string"><span class="delimiter">'</span><span class="content">1.0.1-Final</span><span class="delimiter">'</span></span>,
   slf4j: <span class="string"><span class="delimiter">'</span><span class="content">1.5.8</span><span class="delimiter">'</span></span>, log4j: <span class="string"><span class="delimiter">'</span><span class="content">1.2.14</span><span class="delimiter">'</span></span>, jbossas: <span class="string"><span class="delimiter">'</span><span class="content">6.0.0.Final</span><span class="delimiter">'</span></span>, glassfish: <span class="string"><span class="delimiter">'</span><span class="content">3.0.1-b20</span><span class="delimiter">'</span></span>, cdi: <span class="string"><span class="delimiter">'</span><span class="content">1.0-SP1</span><span class="delimiter">'</span></span>
]

repositories {
   mavenCentral()
   mavenRepo urls: <span class="string"><span class="delimiter">'</span><span class="content">http://repository.jboss.org/nexus/content/groups/public</span><span class="delimiter">'</span></span>
   mavenRepo urls: <span class="string"><span class="delimiter">'</span><span class="content">http://repository.jboss.org/nexus/content/repositories/deprecated</span><span class="delimiter">'</span></span>
}

configurations {
   compileOnly
   weldEmbeddedTestRuntime { extendsFrom testRuntime }
   jbossasRemoteTestRuntime { extendsFrom testRuntime, compileOnly }
   glassfishEmbeddedTestRuntime { extendsFrom testRuntime }
}

dependencies {
   compileOnly group: <span class="string"><span class="delimiter">'</span><span class="content">javax.enterprise</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">cdi-api</span><span class="delimiter">'</span></span>, version: libraryVersions.cdi

   testCompile group: <span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>, version: libraryVersions.junit
   testCompile group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-junit</span><span class="delimiter">'</span></span>, version: libraryVersions.arquillian

   <span class="comment">// temporarily downgrade the weld-ee-embedded-1.1 container</span>
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian.container</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-weld-ee-embedded-1.1</span><span class="delimiter">'</span></span>, version: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Alpha3</span><span class="delimiter">'</span></span>
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.spec</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">jboss-javaee-6.0</span><span class="delimiter">'</span></span>, version: libraryVersions.jbossJavaeeSpec
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.weld</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">weld-core</span><span class="delimiter">'</span></span>, version: libraryVersions.weld
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.slf4j</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">slf4j-log4j12</span><span class="delimiter">'</span></span>, version: libraryVersions.slf4j
   weldEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">log4j</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">log4j</span><span class="delimiter">'</span></span>, version: libraryVersions.log4j

   jbossasRemoteTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian.container</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-jbossas-remote-6</span><span class="delimiter">'</span></span>, version: libraryVersions.arquillian
   jbossasRemoteTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.jbossas</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">jboss-as-server</span><span class="delimiter">'</span></span>, classifier: <span class="string"><span class="delimiter">'</span><span class="content">client</span><span class="delimiter">'</span></span>, version: libraryVersions.jbossas, transitive: <span class="predefined-constant">false</span>
   jbossasRemoteTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.jbossas</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">jboss-as-profileservice</span><span class="delimiter">'</span></span>, classifier: <span class="string"><span class="delimiter">'</span><span class="content">client</span><span class="delimiter">'</span></span>, version: libraryVersions.jbossas

   glassfishEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian.container</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-glassfish-embedded-3</span><span class="delimiter">'</span></span>, version: libraryVersions.arquillian
   glassfishEmbeddedTestRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.glassfish.extras</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">glassfish-embedded-all</span><span class="delimiter">'</span></span>, version: libraryVersions.glassfish
}

sourceSets {
   main {
      compileClasspath = configurations.compile + configurations.compileOnly
   }
   test {
      compileClasspath = compileClasspath + configurations.compileOnly
   }
}

task weldEmbeddedTest(type: Test) {
   testClassesDir = sourceSets.test.classesDir
   classpath = sourceSets.test.classes + sourceSets.main.classes + configurations.weldEmbeddedTestRuntime
}

task jbossasRemoteTest(type: Test) {
   testClassesDir = sourceSets.test.classesDir
   classpath = sourceSets.test.classes + sourceSets.main.classes + files(<span class="string"><span class="delimiter">'</span><span class="content">src/test/resources-jbossas</span><span class="delimiter">'</span></span>) + configurations.jbossasRemoteTestRuntime
}

task glassfishEmbeddedTest(type: Test) {
   testClassesDir = sourceSets.test.classesDir
   classpath = sourceSets.test.classes + sourceSets.main.classes + configurations.glassfishEmbeddedTestRuntime
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice we&#8217;ve added an extra resources directory for remote JBoss AS 6 to
include the required jndi.properties file. That&#8217;s a special
configuration for the remote JBoss AS containers, though won&#8217;t be
required after Arquillian 1.0.0.Alpha4.</p>
</div>
<div class="paragraph">
<p>It&#8217;s now possible to run the Arquillian tests against each of the three
containers in sequence using this Gradle command (make sure a JBoss AS
is started in the background):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">gradle weldEmbeddedTest jbossasRemoteTest glassfishEmbeddedTest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pretty cool, huh?</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s look at another way to solve this problem.</p>
</div>
</div>
<div class="sect4">
<h5 id="_strategy_2_test_profiles"><a class="anchor" href="#_strategy_2_test_profiles"></a>Strategy #2: Test Profiles</h5>
<div class="paragraph">
<p>Another way to approach integrating Arquillian into a Gradle build is to
emulate the behavior of Maven profiles. In this case, we won&#8217;t be adding
any extra tasks, rather overriding the Java plugin configuration and
provided tasks.</p>
</div>
<div class="paragraph">
<p>A Maven profile effectively overrides portions of the build
configuration and is activated using a command option (or some other
profile activation setting).</p>
</div>
<div class="paragraph">
<p>Once again, let&#8217;s assume that we want to run the tests against the
following three Arquillian-supported containers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Weld EE Embedded 1.1</p>
</li>
<li>
<p>Remote JBoss AS 6</p>
</li>
<li>
<p>Embedded GlassFish 3</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All we need to do is customize the test runtime classpath for each
container. First, let&#8217;s setup the common compile-time dependencies in
the main build file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: JavaPlugin

buildDir = <span class="string"><span class="delimiter">'</span><span class="content">target/gradle-build</span><span class="delimiter">'</span></span>

libraryVersions = [
   junit: <span class="string"><span class="delimiter">'</span><span class="content">4.8.1</span><span class="delimiter">'</span></span>, arquillian: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Alpha3</span><span class="delimiter">'</span></span>, jbossJavaeeSpec: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Beta7</span><span class="delimiter">'</span></span>, weld: <span class="string"><span class="delimiter">'</span><span class="content">1.0.1-Final</span><span class="delimiter">'</span></span>,
   slf4j: <span class="string"><span class="delimiter">'</span><span class="content">1.5.8</span><span class="delimiter">'</span></span>, log4j: <span class="string"><span class="delimiter">'</span><span class="content">1.2.14</span><span class="delimiter">'</span></span>, jbossas: <span class="string"><span class="delimiter">'</span><span class="content">6.0.0.Final</span><span class="delimiter">'</span></span>, glassfish: <span class="string"><span class="delimiter">'</span><span class="content">3.0.1-b20</span><span class="delimiter">'</span></span>, cdi: <span class="string"><span class="delimiter">'</span><span class="content">1.0-SP1</span><span class="delimiter">'</span></span>
]

repositories {
   mavenCentral()
   mavenRepo urls: <span class="string"><span class="delimiter">'</span><span class="content">http://repository.jboss.org/nexus/content/groups/public</span><span class="delimiter">'</span></span>
}

configurations {
   compileOnly
}

dependencies {
   group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.spec</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">jboss-javaee-6.0</span><span class="delimiter">'</span></span>, version: libraryVersions.jbossJavaeeSpec
}

sourceSets {
   main {
      compileClasspath = configurations.compile + configurations.compileOnly
   }
   test {
      compileClasspath = compileClasspath + configurations.compileOnly
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We then need to create a partial Gradle build file for each container
that contains the container-specific dependencies and configuration.
Let&#8217;s start with Weld EE Embedded.</p>
</div>
<div class="paragraph">
<p>Create a file named weld-ee-embedded-profile.gradle and populate it with
the following contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dependencies {
   <span class="comment">// temporarily downgrade the weld-ee-embedded-1.1 container</span>
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian.container</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-weld-ee-embedded-1.1</span><span class="delimiter">'</span></span>, version: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Alpha3</span><span class="delimiter">'</span></span>
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.spec</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">jboss-javaee-6.0</span><span class="delimiter">'</span></span>, version: libraryVersions.jbossJavaeeSpec
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.weld</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">weld-core</span><span class="delimiter">'</span></span>, version: libraryVersions.weld
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.slf4j</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">slf4j-log4j12</span><span class="delimiter">'</span></span>, version: libraryVersions.slf4j
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">log4j</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">log4j</span><span class="delimiter">'</span></span>, version: libraryVersions.log4j
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s the partial build file for Remote JBoss AS, named
jbossas-remote-profile.gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dependencies {
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">javax.enterprise</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">cdi-api</span><span class="delimiter">'</span></span>, version: libraryVersions.cdi
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian.container</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-jbossas-remote-6</span><span class="delimiter">'</span></span>, version: libraryVersions.arquillian
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.jbossas</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">jboss-as-server</span><span class="delimiter">'</span></span>, classifier: <span class="string"><span class="delimiter">'</span><span class="content">client</span><span class="delimiter">'</span></span>, version: libraryVersions.jbossas, transitive: <span class="predefined-constant">false</span>
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.jbossas</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">jboss-as-profileservice</span><span class="delimiter">'</span></span>, classifier: <span class="string"><span class="delimiter">'</span><span class="content">client</span><span class="delimiter">'</span></span>, version: libraryVersions.jbossas
}

test {
   classpath = sourceSets.test.classes + sourceSets.main.classes + files(<span class="string"><span class="delimiter">'</span><span class="content">src/test/resources-jbossas</span><span class="delimiter">'</span></span>) + configurations.testRuntime
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally the one for Embedded GlassFish, named
glassfish-embedded-profile.gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">dependencies {
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian.container</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-glassfish-embedded-3</span><span class="delimiter">'</span></span>, version: libraryVersions.arquillian
   testRuntime group: <span class="string"><span class="delimiter">'</span><span class="content">org.glassfish.extras</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">glassfish-embedded-all</span><span class="delimiter">'</span></span>, version: libraryVersions.glassfish
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we need to import the appropriate partial Gradle build into the main
build. The file will be selected based on the value of the project
property named profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">apply plugin: JavaPlugin

buildDir = <span class="string"><span class="delimiter">'</span><span class="content">target/gradle-build</span><span class="delimiter">'</span></span>

libraryVersions = [
   junit: <span class="string"><span class="delimiter">'</span><span class="content">4.8.1</span><span class="delimiter">'</span></span>, arquillian: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Alpha4</span><span class="delimiter">'</span></span>, jbossJavaeeSpec: <span class="string"><span class="delimiter">'</span><span class="content">1.0.0.Beta7</span><span class="delimiter">'</span></span>, weld: <span class="string"><span class="delimiter">'</span><span class="content">1.0.1-Final</span><span class="delimiter">'</span></span>,
   slf4j: <span class="string"><span class="delimiter">'</span><span class="content">1.5.8</span><span class="delimiter">'</span></span>, log4j: <span class="string"><span class="delimiter">'</span><span class="content">1.2.14</span><span class="delimiter">'</span></span>, jbossas: <span class="string"><span class="delimiter">'</span><span class="content">6.0.0.Final</span><span class="delimiter">'</span></span>, glassfish: <span class="string"><span class="delimiter">'</span><span class="content">3.0.1-b20</span><span class="delimiter">'</span></span>, cdi: <span class="string"><span class="delimiter">'</span><span class="content">1.0-SP1</span><span class="delimiter">'</span></span>
]

apply from: profile + <span class="string"><span class="delimiter">'</span><span class="content">-profile.gradle</span><span class="delimiter">'</span></span>

repositories {
   mavenCentral()
   mavenRepo urls: <span class="string"><span class="delimiter">'</span><span class="content">http://repository.jboss.org/nexus/content/groups/public</span><span class="delimiter">'</span></span>
}

configurations {
   compileOnly
}

dependencies {
   compileOnly group: <span class="string"><span class="delimiter">'</span><span class="content">javax.enterprise</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">cdi-api</span><span class="delimiter">'</span></span>, version: libraryVersions.cdi

   testCompile group: <span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">junit</span><span class="delimiter">'</span></span>, version: libraryVersions.junit
   testCompile group: <span class="string"><span class="delimiter">'</span><span class="content">org.jboss.arquillian</span><span class="delimiter">'</span></span>, name: <span class="string"><span class="delimiter">'</span><span class="content">arquillian-junit</span><span class="delimiter">'</span></span>, version: libraryVersions.arquillian
}

sourceSets {
   main {
      compileClasspath = configurations.compile + configurations.compileOnly
   }
   test {
      compileClasspath = compileClasspath + configurations.compileOnly
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tests are run in the Weld EE Embedded runtime using this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">gradle test -Pprofile=weld-ee-embedded</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s pretty much the same experience you get when you use Maven (and a
whole heck of a lot simpler).</p>
</div>
<div class="paragraph">
<p>While the configuration is much simpler using the profiles strategy,
there are two things to keep in mind:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It crosses over into more than one build file</p>
</li>
<li>
<p>You cannot run the tests in each container in a single build
execution</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you have a better idea of how to integrate an Arquillian test suite
into a Gradle build, we&#8217;d love to hear it on the
<a href="http://community.jboss.org/en/arquillian">Arquillian discussion forums</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ant-ivy"><a class="anchor" href="#ant-ivy"></a>2.8.4. Ant + Ivy</h4>
<div class="paragraph">
<p>WRITE ME</p>
</div>
</div>
<div class="sect3">
<h4 id="ant"><a class="anchor" href="#ant"></a>2.8.5. Ant</h4>
<div class="paragraph">
<p>This guide will detail how to use Arquillian using ant. We will use
maven to download all the required jars.</p>
</div>
<div class="paragraph">
<p>Overview of Steps</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setup Example Maven project</p>
</li>
<li>
<p>Get All Arquillian dependency jars</p>
</li>
<li>
<p>configure ant scripts</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Work in progress. Please return.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contents_of_distribution"><a class="anchor" href="#_contents_of_distribution"></a>3. Contents of distribution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Arquillian Core, Container Extension, Test Extension, Test integration for JUnit and TestNG, Common TestEnrichers and Common Protocols.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_licensing"><a class="anchor" href="#_licensing"></a>4. Licensing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This distribution, as a whole, is licensed under the terms of the Apache License, Version 2.0 (see apl.txt).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arquillian_urls"><a class="anchor" href="#_arquillian_urls"></a>5. Arquillian URLs</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="http://arquillian.org/guides">Guides</a></p>
</li>
<li>
<p><a href="http://arquillian.org">Project Site</a></p>
</li>
<li>
<p><a href="http://community.jboss.org/community/arquillian">User Forums &amp; Wiki</a></p>
</li>
<li>
<p><a href="http://community.jboss.org/community/arquillian/dev">Development Forums &amp; Wiki</a></p>
</li>
<li>
<p><a href="https://jira.jboss.org/jira/browse/ARQ">Issue Tracker</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-03-16 16:20:53 UTC
</div>
</div>
</body>
</html>